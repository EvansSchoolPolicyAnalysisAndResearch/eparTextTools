---
title: "Scraping Structured Documents
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Structured docments provide the opportunity to move beyond adopting all text strings for text analysis. Because structured documents such as forms possess entry areas that specify what is supposedly included in the following lines, we can utilize that structure to help define features of the text or characteristics of the documents. 

In terms of structured documents, there are multple kinds a user may run across. First of all, a structured PDF may have OCR labelled text that is in a similar location across a wide body of documents. These are among the more complicated documents to code as one has to rely on characters either being recognized the same across a range of responses or the text information must remained stored in a similar manner across the corpus. Word documents can have structured form fields--this is much less of a problem for extracting data, and we can rely on commmon tools such as Microsoft Access to batch process results. However, this vignette demonstrates how to utilize R to extract necessary information from form fields rapidly by visually assessing the form document and deciding what information is needed for a database.

#Demonstration
??viewer
tfiles<-list.files("../epar/PracticeDocs2/files",full.names=T)
tfiles<-tfiles[str_detect(tolower(tfiles),"docx")]

docx_table_view<-function(file){
#file<-tfiles[1]
tmp <- tempfile()
if (!dir.create(tmp)) 
  stop("Temporary directory could not be established.")
utils::unzip(file, exdir = tmp)
xmlfile <- file.path(tmp, "word", "document.xml")
doc <- XML::xmlTreeParse(xmlfile, useInternalNodes = TRUE)
nodeSet <- XML::getNodeSet(doc, "//w:p")
unlink(tmp, recursive = TRUE)
docxml <- sapply(nodeSet, XML::xmlValue)
View(dplyr::filter(data.frame("content"=na.omit(stringr::str_trim(docxml))),content!=""))
}
docx_table_view(tfiles[1])

docx_man_ex<-function(file,string1,string2){
tmp <- tempfile()
if (!dir.create(tmp)) 
  stop("Temporary directory could not be established.")
utils::unzip(file, exdir = tmp)
xmlfile <- file.path(tmp, "word", "document.xml")
doc <- XML::xmlTreeParse(xmlfile, useInternalNodes = TRUE)
nodeSet <- XML::getNodeSet(doc, "//w:p")
unlink(tmp, recursive = TRUE)
docxml <- sapply(nodeSet, XML::xmlValue)
cell_extractor(docxml,string1,string2)}


docx_man_ex(tfiles[1],tolower("Development"),"Invest")




## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
